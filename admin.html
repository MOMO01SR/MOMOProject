<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Panel</title>
<style>
body{font-family:Arial;margin:20px;background:#0f1b2b;color:#fff;}
table{width:100%;border-collapse:collapse;}
th,td{border:1px solid #555;padding:10px;text-align:left;}
th{background:#18c4b8;color:#003;}
button{padding:5px 10px;margin:2px;border:none;border-radius:5px;cursor:pointer;}
button.delete{background:red;color:#fff;}
button.disable{background:orange;color:#fff;}
button.edit{background:#00ff99;color:#003;}
input.editInput{width:90%;padding:5px;border-radius:5px;border:none;}
</style>
</head>
<body>

<h1>Admin Panel</h1>
<table id="usersTable"></table>

<script>
async function fetchUsers(){
  return await fetch('/api/users').then(r=>r.json());
}

async function saveUsers(users){
  await fetch('/api/users',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify(users)
  });
}

function createTableRow(user,index){
  return `<tr>
    <td><input class="editInput" value="${user.email}" onchange="updateUserField(${index},'email',this.value)"></td>
    <td><input class="editInput" value="${user.password}" onchange="updateUserField(${index},'password',this.value)"></td>
    <td><input class="editInput" value="${user.withdrawPass||''}" onchange="updateUserField(${index},'withdrawPass',this.value)"></td>
    <td>${user.inviteCode||''}</td>
    <td><input class="editInput" type="number" value="${user.balance||0}" onchange="updateUserField(${index},'balance',parseFloat(this.value))"></td>
    <td>
      <button class="delete" onclick="deleteUser(${index})">Delete</button>
      <button class="disable" onclick="toggleUser(${index})">${user.disabled?'Enable':'Disable'}</button>
    </td>
  </tr>`;
}

async function loadUsers(){
  const users = await fetchUsers();
  const table = document.getElementById('usersTable');
  table.innerHTML = '<tr><th>Email</th><th>Password</th><th>Withdraw</th><th>Invite</th><th>Balance</th><th>Actions</th></tr>';
  users.forEach((u,i)=>{
    table.innerHTML += createTableRow(u,i);
  });
}

// تحديث حقل واحد للمستخدم
async function updateUserField(index,field,value){
  const users = await fetchUsers();
  users[index][field] = value;
  await saveUsers(users);
  loadUsers();
}

// حذف مستخدم
async function deleteUser(index){
  const users = await fetchUsers();
  if(confirm('Are you sure you want to delete this user?')){
    users.splice(index,1);
    await saveUsers(users);
    loadUsers();
  }
}

// حظر أو تفعيل حساب
async function toggleUser(index){
  const users = await fetchUsers();
  users[index].disabled = !users[index].disabled;
  await saveUsers(users);
  loadUsers();
}

loadUsers();
</script>
</body>
</html>